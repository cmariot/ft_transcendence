user				nginx;
worker_processes	auto;

error_log			/var/log/nginx/error.log notice;
pid					/var/run/nginx.pid;

events
{
	worker_connections	1024;
}

http
{

	include					/etc/nginx/mime.types;
	default_type			application/octet-stream;
	log_format	main		'$remote_addr - $remote_user [$time_local] "$request" '
							'$status $body_bytes_sent "$http_referer" '
							'"$http_user_agent" "$http_x_forwarded_for"';
	access_log				/var/log/nginx/access.log  main;
	sendfile				on;
	keepalive_timeout		65;

	server
	{
		listen					443 ssl default_server;
		server_name				localhost ft_transcendence.fr;

		ssl_protocols			TLSv1.2 TLSv1.3;
		ssl_certificate			/ssl/ft_transcendence.pem;
		ssl_certificate_key		/ssl/ft_transcendence.key;

		client_max_body_size	1M;

		location /
		{
			proxy_pass http://frontend:4000;

			proxy_http_version 1.1;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "Upgrade";
			proxy_set_header X_Forwarded-For $proxy_add_x_forwarded_for;
		}

		location /api/
		{
			proxy_pass http://backend:3000;
			rewrite /api/(.*) /$1 break;

			proxy_http_version 1.1;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "Upgrade";
			proxy_set_header X_Forwarded-For $proxy_add_x_forwarded_for;
		}

	}
}
